<section class="layout-shell">
  <header class="layout-header">
    <p class="eyebrow">Profile builder</p>
    @if (showHeading) {
      <h1>Portfolio</h1>
    }
    <p class="layout-subtext">
      Craft a clean, shareable snapshot of your story.
    </p>
  </header>

  @if (!submitted) {
    <div class="layout-grid">
      <ng-container
        [ngTemplateOutlet]="sectionCard"
        [ngTemplateOutletContext]="{
          title: 'Personal Information',
          subtitle: 'Basics that appear on your profile.',
          template: personalForm,
        }"
      ></ng-container>
      <ng-container
        [ngTemplateOutlet]="sectionCard"
        [ngTemplateOutletContext]="{
          title: 'Qualifications',
          subtitle: 'Add your education or certifications.',
          template: qualificationForm,
        }"
      ></ng-container>
    </div>
    <div class="btn-container">
      <button type="button" class="btn ghost" (click)="addQualification()">
        Add Qualification
      </button>
      <button type="submit" class="btn primary" (click)="formSubmit()">
        Submit
      </button>
    </div>
  } @else {
    <ng-container [ngTemplateOutlet]="preview"></ng-container>
  }

  <ng-template
    #sectionCard
    let-title="title"
    let-subtitle="subtitle"
    let-template="template"
  >
    <section class="card">
      <header class="card-header">
        <div>
          <h2>{{ title }}</h2>
          <p>{{ subtitle }}</p>
        </div>
        <span class="chip">Draft</span>
      </header>
      <ng-container [ngTemplateOutlet]="template"></ng-container>
    </section>
  </ng-template>

  <ng-template #personalForm>
    <form class="layout-grid">
      <label class="field">
        <span>Name</span>
        <input type="text" name="name" [(ngModel)]="nm" autocomplete="off" />
      </label>
      <label class="field">
        <span>Email</span>
        <input type="email" name="email" [(ngModel)]="em" autocomplete="off" />
      </label>
      <label class="field">
        <span>Phone</span>
        <input type="tel" name="phone" [(ngModel)]="ph" autocomplete="off" />
      </label>
      <label class="field">
        <span>Address</span>
        <input type="text" name="address" [(ngModel)]="add" />
      </label>
    </form>
  </ng-template>

  <ng-template #qualificationForm>
    <div class="qualification-list">
      @for (q of qualification; track q; let i = $index) {
        <article class="qualification-card">
          <div class="qualification-header">
            <h3>Qualification {{ i + 1 }}</h3>
            <span>Entry {{ i + 1 }}</span>
          </div>
          <form class="form-grid">
            <label class="field">
              <span>School/College</span>
              <input
                type="text"
                name="school"
                [(ngModel)]="q.school"
                autocomplete="off"
              />
            </label>
            <label class="field">
              <span>Degree</span>
              <input
                type="text"
                name="degree"
                [(ngModel)]="q.degree"
                autocomplete="off"
              />
            </label>
            <label class="field">
              <span>Year</span>
              <input
                type="text"
                name="year"
                [(ngModel)]="q.year"
                autocomplete="off"
              />
            </label>
          </form>
        </article>
      }
    </div>
  </ng-template>
</section>

<ng-template #preview>
  <section class="preview-container">
    <header class="preview-header">
      <div>
        <p class="eyebrow">Preview</p>
        <h2>Portfolio snapshot</h2>
      </div>
      <button class="btn outline" type="button" (click)="formEdit()">
        Edit
      </button>
    </header>
    <div class="layout-grid">
      <div class="preview-card">
        <p [class]="{ name: true }">{{ nm || "Unnamed profile" }}</p>
        <p>Email : {{ em || "Not provided" }}</p>
        <p>Phone : {{ ph || "Not provided" }}</p>
        <p>Address : {{ add || "Not provided" }}</p>
      </div>
      <div class="preview-card">
        <h4>Qualifications</h4>
        <div class="preview-qualifications">
          @for (q of qualification; track q; let i = $index) {
            <ng-container
              [ngTemplateOutlet]="qualificationPreview"
              [ngTemplateOutletContext]="{ qualification: q, index: i }"
            ></ng-container>
          }
        </div>
      </div>
    </div>
  </section>
</ng-template>

<ng-template
  #qualificationPreview
  let-qualification="qualification"
  let-index="index"
>
  <div class="preview-item">
    <h5>Qualification {{ index + 1 }}</h5>
    <p>School/College : {{ qualification.school || "Not provided" }}</p>
    <p>
      Degree : {{ qualification.degree || "Not provided" }} ({{
        qualification.year || "N/A"
      }})
    </p>
  </div>
</ng-template>
