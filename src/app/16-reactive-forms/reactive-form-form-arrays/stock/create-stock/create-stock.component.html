<h2>Create Stock Form (Reactive Form Arrays)</h2>

<div class="mb-3">
  <form [formGroup]="stockForm" (ngSubmit)="onSubmit()">
    <div class="mb-3">
      <label for="stockName" class="form-label">Stock Name</label>
      <input
        id="stockName"
        type="text"
        placeholder="Stock Name"
        name="stockName"
        formControlName="name"
        class="form-control"
        [class.is-invalid]="
          stockForm.get('name')?.invalid &&
          (stockForm.get('name')?.dirty || stockForm.get('name')?.touched)
        "
      />
      <div
        *ngIf="
          stockForm.get('name')?.invalid &&
          (stockForm.get('name')?.dirty || stockForm.get('name')?.touched)
        "
        class="invalid-feedback d-block"
      >
        Name is required
      </div>
    </div>
    <div class="mb-3">
      <label for="stockCode" class="form-label">Stock Code</label>
      <input
        id="stockCode"
        type="text"
        placeholder="Stock Code"
        formControlName="code"
        class="form-control"
        [class.is-invalid]="
          stockForm.get('code')?.invalid &&
          (stockForm.get('code')?.dirty || stockForm.get('code')?.touched)
        "
      />
      <div
        *ngIf="
          stockForm.get('code')?.invalid &&
          (stockForm.get('code')?.dirty || stockForm.get('code')?.touched)
        "
        class="invalid-feedback d-block"
      >
        <div *ngIf="stockForm.get('code')?.errors?.['required']">
          Stock Code is required
        </div>
        <div *ngIf="stockForm.get('code')?.errors?.['minlength']">
          Stock Code must be atleast 2 characters
        </div>
      </div>
    </div>
    <div class="mb-3">
      <label for="stockPrice" class="form-label">Stock Price</label>
      <input
        id="stockPrice"
        type="number"
        placeholder="Stock Price"
        formControlName="price"
        class="form-control"
        [class.is-invalid]="
          stockForm.get('price')?.invalid &&
          (stockForm.get('price')?.dirty || stockForm.get('price')?.touched)
        "
      />
      <div
        *ngIf="
          stockForm.get('price')?.invalid &&
          (stockForm.get('price')?.dirty || stockForm.get('price')?.touched)
        "
        class="invalid-feedback d-block"
      >
        <div *ngIf="stockForm.get('price')?.errors?.['required']">
          Stock Price is required
        </div>
        <div *ngIf="stockForm.get('price')?.errors?.['min']">
          Stock price must be positive
        </div>
      </div>
    </div>
    <div formArrayName="notablePeople">
      <div
        *ngFor="let person of notablePeople.controls; let i = index"
        [formGroupName]="i"
        class="border rounded p-3 mb-3 bg-light"
      >
        <div class="fw-semibold mb-2">Person {{ i + 1 }}</div>

        <label class="form-label" [attr.for]="'person-name-' + i">
          Person Name
        </label>
        <input
          [attr.id]="'person-name-' + i"
          type="text"
          placeholder="Person Name"
          formControlName="name"
          class="form-control mb-3"
        />

        <label class="form-label" [attr.for]="'person-title-' + i">
          Person Title
        </label>
        <input
          [attr.id]="'person-title-' + i"
          type="text"
          placeholder="Person Title"
          formControlName="title"
          class="form-control mb-3"
        />

        <button
          type="button"
          class="btn btn-outline-danger btn-sm"
          (click)="removeNotablePerson(i)"
        >
          Remove Person
        </button>
      </div>
    </div>
    <button
      type="button"
      class="btn btn-outline-primary me-2"
      (click)="addNotablePerson()"
    >
      Add Notable Person
    </button>
    <button
      type="submit"
      class="btn btn-primary me-2"
    >
      Submit
    </button>
    <button
      type="button"
      (click)="resetForm()"
      class="btn btn-outline-secondary"
    >
      Reset
    </button>
  </form>

  <h4>Stock is</h4>
  <code class="json-output">{{ stockForm.value | json }}</code>
  <h4>Form Status is</h4>
  <code class="json-output">{{ stockForm.status | json }}</code>
  <h4>Stock Value</h4>
  <code class="json-output">{{ stock | json }}</code>
  <h3 class="text-danger" *ngIf="stockForm.invalid">Form is Invalid</h3>
</div>
